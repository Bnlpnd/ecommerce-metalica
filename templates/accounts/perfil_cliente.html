<div class="row">
    <div id="mensaje-exito" class="alert alert-success d-none" role="alert">
        <i class="fas fa-check-circle"></i> Perfil actualizado.
    </div>


    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4><i class="fas fa-user-edit text-primary"></i> Mi Perfil</h4>
            <span class="badge bg-primary">Editable</span>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle"></i> {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <div id="perfil-container">
            {% include 'accounts/perfil_cliente_form.html' %}
        </div>
        
    </div>
</div>

<script>
function activarFormularioPerfil() {
    const form = document.querySelector('#perfil-container form');
    if (form) {
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(form);

            fetch("{% url 'perfil_cliente' %}", {
                method: "POST",
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                },
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const mensaje = document.getElementById('mensaje-exito');
                    if (mensaje) {
                        mensaje.classList.remove('d-none');
                        setTimeout(() => mensaje.classList.add('d-none'), 3000);
                    }
                    // Reemplazar HTML y volver a activar script
                    document.getElementById('perfil-container').innerHTML = data.html;
                    activarFormularioPerfil(); // üß† importante
                } else {
                    alert("‚ö†Ô∏è Error al guardar los datos.");
                }
            })
            .catch(error => {
                console.error("‚ùå Error en el guardado AJAX:", error);
            });
        });
    }
}

document.addEventListener('DOMContentLoaded', activarFormularioPerfil);
</script>


