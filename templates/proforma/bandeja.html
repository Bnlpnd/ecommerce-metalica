{% extends 'home/base.html' %}
{% block content %}

<div class="container-fluid mt-4">
  <div class="alert alert-info">
    Proformas cargadas: {{ proformas|length }}
  </div>

  <div class="row">
    <!-- Bandeja lateral -->
    <div class="col-md-3">
        <h5 class="mt-2">Proformas pendientes</h5>
        <div class="list-group">
            {% for p in proformas %}
            <a href="#" onclick="mostrarProforma('{{ p.proforma_num }}')" class="list-group-item list-group-item-action">
                <strong>{{ p.proforma_num }}</strong><br>
                <small>{{ p.cliente.username }}</small><br>
                <small>{{ p.fecha|date:"d/m/Y" }}</small>
            </a>

            {% empty %}
            <p class="text-muted px-3">No hay proformas pendientes.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Panel derecho: Detalle de proforma -->
    <div class="col-md-9" id="detalle-proforma">
      <p class="text-muted">Selecciona una proforma para revisar detalles.</p>
    </div>
  </div>
</div>

<script>
  function mostrarProforma(proforma_num) {

    // Cambia la URL en la barra del navegador
    const nuevaURL = `/proforma/bandeja/${proforma_num}/`;
    window.history.pushState({ proforma: proforma_num }, '', nuevaURL);

    // Carga el contenido de la proforma
    fetch(`/proforma/ver/${proforma_num}/`)
      .then(response => response.text())
      .then(html => {
        document.getElementById("detalle-proforma").innerHTML = html;
      });
  }
</script>


{% endblock %}
