{% extends "home/base.html" %} {% block content %}
<div class="container mt-4">
  <div class="card p-4">
    <h2 class="mb-3">{{ modelo.productmaterial_name }}</h2>

    <div class="row">
      <!-- Imagen del producto -->
      <div class="col-md-6 text-center">
        {% if imagen %}
        <img
          src="{{ imagen.image.url }}"
          alt="Imagen del producto"
          class="img-fluid"
          style="max-height: 300px; border: 1px solid #ccc"
        />
        {% else %}
        <div
          style="
            border: 2px solid #ccc;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
          "
        >
          <span style="font-size: 3rem">üñºÔ∏è</span>
        </div>
        {% endif %}
      </div>

      <!-- Informaci√≥n -->
      <div class="col-md-6">
        <h5>Descripci√≥n:</h5>
        <ul>
          <li>{{ modelo.product.description|linebreaks }}</li>
        </ul>
        <h5>Ventajas:</h5>
        <ul>
          <li>{{ modelo.product.detalle|linebreaks }}</li>
        </ul>
        <h5>Detalle del modelo:</h5>
        <ul>
          <li>{{ modelo.description|linebreaks }}</li>
        </ul>

        <!-- Botones -->
        <div class="d-flex gap-2 mt-3">
          <a href="{% url 'galeria' %}" class="btn btn-secondary w-50">
            Volver
          </a>
          <button onclick="a√±adirAProforma('{{ modelo.product.uid }}', '{{ modelo.uid }}', '{{ modelo.product.product_name }}', '{{ modelo.productmaterial_name }}')" class="btn btn-primary w-50">
            A√±adir a proforma
          </button>
        </div>
        <!-- <a href="{% url 'galeria' %}" class="btn btn-secondary mt-3">Volver</a> -->
      </div>
    </div>
  </div>
</div>

<script>
function a√±adirAProforma(productoUid, modeloUid, productoNombre, modeloNombre) {
  // Obtener datos existentes del localStorage
  const STORAGE_KEY = 'proforma_draft';
  let datosExistentes = [];
  
  try {
    const datos = localStorage.getItem(STORAGE_KEY);
    if (datos) {
      datosExistentes = JSON.parse(datos);
    }
  } catch (error) {
    console.error('Error cargando datos existentes:', error);
  }
  
  // Crear nuevo item
  const nuevoItem = {
    cantidad: '1',
    producto: productoUid,
    modelo: modeloUid,
    alto: '',
    ancho: '',
    color: '',
    pregunta1: '',
    pregunta2: '',
    pregunta3: ''
  };
  
  // Agregar el nuevo item
  datosExistentes.push(nuevoItem);
  
  // Guardar en localStorage
  localStorage.setItem(STORAGE_KEY, JSON.stringify(datosExistentes));
  
  // Mostrar mensaje de confirmaci√≥n
  const mensaje = `‚úÖ "${modeloNombre}" agregado a la proforma\n\nTotal de productos en proforma: ${datosExistentes.length}`;
  
  // Crear modal de confirmaci√≥n
  const modal = document.createElement('div');
  modal.className = 'modal fade show';
  modal.style.display = 'block';
  modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
  modal.innerHTML = `
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            <i class="fas fa-check-circle"></i> Producto Agregado
          </h5>
        </div>
        <div class="modal-body">
          <p><strong>Producto:</strong> ${productoNombre}</p>
          <p><strong>Modelo:</strong> ${modeloNombre}</p>
          <p><strong>Total en proforma:</strong> ${datosExistentes.length} producto(s)</p>
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> El producto se ha guardado en tu proforma. Puedes continuar agregando m√°s productos o ir a completar la proforma.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="seguirNavegando()">Seguir navegando</button>
          <a href="{% url 'proforma' %}" class="btn btn-primary">
            <i class="fas fa-shopping-cart"></i> Ir a Proforma
          </a>
        </div>
      </div>
    </div>
  `;
  
  // Agregar al body
  document.body.appendChild(modal);
  
  // Funci√≥n para cerrar modal
  window.cerrarModal = function() {
    document.body.removeChild(modal);
  };
  
  // Funci√≥n para seguir navegando (ir a p√°gina anterior)
  window.seguirNavegando = function() {
    cerrarModal();
    // Usar history.back() para ir a la p√°gina anterior
    if (window.history.length > 1) {
      window.history.back();
    } else {
      // Si no hay historial, ir a la galer√≠a
      window.location.href = "{% url 'galeria' %}";
    }
  };
  
  // Cerrar modal al hacer clic fuera
  modal.addEventListener('click', function(e) {
    if (e.target === modal) {
      cerrarModal();
    }
  });
  
  console.log('‚úÖ Producto agregado a proforma:', nuevoItem);
}
</script>

{% endblock %}
